<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-3.xsd">

<service verb="createUpdate" noun="MoquiTraining">
    <in-parameters>
        <parameter name="trainingID"/>
        <parameter name="trainingName" required="true"/>
        <parameter name="trainingDate" required="true"  format="MM/DD/YYYY"/>
        <parameter name="trainingPrice"/>
        <parameter name="trainingDuration"/>
    </in-parameters>
    <out-parameters>
        <parameter name="trainingID"/>
    </out-parameters>
    <actions>
        <script>
            <![CDATA[
    // Fetch existing record by trainingID or trainingName
    def trainingRecord = ec.entity.find("moqui.training.MoquiTraining")
    if (context.trainingID) {
        trainingRecord.condition("trainingID", context.trainingID)
    } else if (context.trainingName) {
        trainingRecord.condition("trainingName", context.trainingName)
    }
    trainingRecord = trainingRecord.one()

    if (trainingRecord) {
        // Update existing record
        trainingRecord.set("trainingDate", context.trainingDate)
        trainingRecord.set("trainingPrice", context.trainingPrice)
        trainingRecord.set("trainingDuration", context.trainingDuration)
        trainingRecord.update()
        context.trainingID = trainingRecord.trainingID
    } else {
        // Use the provided trainingID or generate a new one
        def newTrainingID = context.trainingID ?: ec.entity.sequencedIdPrimary("moqui.training.MoquiTraining", null, null)
        ec.entity.makeValue("moqui.training.MoquiTraining")
            .set("trainingID", newTrainingID)
            .set("trainingName", context.trainingName)
            .set("trainingDate", context.trainingDate)
            .set("trainingPrice", context.trainingPrice)
            .set("trainingDuration", context.trainingDuration)
            .create()
        context.trainingID = newTrainingID
    }
   ]]>
        </script>
    </actions>
</service>
        </services>